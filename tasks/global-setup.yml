---

- name: GitlabRunner | Create SSL configuration folder.
  file:
    path: "{{ gitlab_runner_tls_path }}"
    state: directory
    owner: root
    group: root
    mode: 0700
  when: "'{{ ssl_certificate }}' != '' "

# Copy gitlab/ci SSL certificate
- name: GitlabRunner | Deploy self-signed certificate.
  template:
    src={{ item.src }}
    dest={{ item.dest }}
    mode=0644
  with_items:
    - src:  "ssl_certificate.j2"
      dest: "{{ gitlab_runner_tls_ca_file }}"
  when: "'{{ ssl_certificate }}' != '' "

# Create user & group `runner` to avoid using `root`

# TODO: use a more elaborate template.
- name: GitlabRunner | set global setup concurrent option
  template:
    src=config.toml.j2
    dest="{{ gitlab_runner_conf_path }}/config.toml"
